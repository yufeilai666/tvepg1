name: Sync Logo Folder

on:
  push:
    branches: [ main ]
    paths: [ 'logo/**' ]
  workflow_dispatch:  # å…è®¸æ‰‹åŠ¨è§¦å‘

jobs:
  sync-logo:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository with full history
      uses: actions/checkout@v4
      with:
        fetch-depth: 0  # è·å–å®Œæ•´å†å²è®°å½•
        token: ${{ secrets.GITHUB_TOKEN }}

    - name: Setup Git configuration for special characters
      run: |
        git config --global core.quotepath false
        git config --global core.precomposeunicode true
        git config --global user.name "github-actions[bot]"
        git config --global user.email "github-actions[bot]@users.noreply.github.com"

    - name: Sync logo folder to logo_info branch
      run: |
        echo "å¼€å§‹åŒæ­¥logoæ–‡ä»¶å¤¹..."
        
        # è®¾ç½®åŒ—äº¬æ—¶é—´
        BEIJING_TIME=$(TZ='Asia/Shanghai' date +'%Y-%m-%d %H:%M:%S')
        echo "å½“å‰ UTC+8 æ—¶é—´: $BEIJING_TIME"
        
        # æ£€æŸ¥logo_infoåˆ†æ”¯æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™åˆ›å»º
        if ! git show-ref --verify --quiet refs/heads/logo_info; then
          echo "åˆ›å»ºlogo_infoåˆ†æ”¯..."
          git checkout -b logo_info
        else
          echo "åˆ‡æ¢åˆ°å·²å­˜åœ¨çš„logo_infoåˆ†æ”¯..."
          git checkout logo_info
          # æ‹‰å–æœ€æ–°æ›´æ”¹ï¼Œé¿å…å†²çª
          git pull origin logo_info || echo "é¦–æ¬¡æ‹‰å–å¯èƒ½å¤±è´¥ï¼Œç»§ç»­..."
        fi
        
        # ä»mainåˆ†æ”¯å¤åˆ¶æ•´ä¸ªlogoæ–‡ä»¶å¤¹ï¼ˆåŒ…å«ä¸­æ–‡æ–‡ä»¶åï¼‰
        echo "ä»mainåˆ†æ”¯å¤åˆ¶logoæ–‡ä»¶å¤¹..."
        git checkout main -- logo/
        
        # æ£€æŸ¥æ˜¯å¦æœ‰æ–‡ä»¶è¢«æ›´æ”¹
        if git status --porcelain | grep -q 'logo/'; then
          echo "æ£€æµ‹åˆ°logoæ–‡ä»¶å¤¹æœ‰æ›´æ”¹ï¼Œå‡†å¤‡æäº¤..."
          
          # æ·»åŠ æ‰€æœ‰logoæ–‡ä»¶
          git add logo/
          
          # æäº¤æ›´æ”¹ï¼ˆä½¿ç”¨åŒ—äº¬æ—¶é—´ï¼‰
          git commit -m "chore: sync logo folder from main branch
          
          - åŒæ­¥logoèµ„æºæ–‡ä»¶
          - åŒ…å«ä¸­æ–‡æ–‡ä»¶åå¤„ç†
          - è‡ªåŠ¨åŒæ­¥æ—¶é—´: $BEIJING_TIME (UTC+8)"
          
          # æ¨é€åˆ°è¿œç¨‹åˆ†æ”¯
          echo "æ¨é€åˆ°è¿œç¨‹logo_infoåˆ†æ”¯..."
          git push origin logo_info
          
          echo "âœ… Logoæ–‡ä»¶å¤¹åŒæ­¥å®Œæˆï¼"
          echo "ğŸ“… åŒæ­¥æ—¶é—´: $BEIJING_TIME (UTC+8)"
        else
          echo "âš ï¸ æ²¡æœ‰æ£€æµ‹åˆ°logoæ–‡ä»¶å¤¹çš„æ›´æ”¹"
        fi

    - name: Show sync result
      run: |
        echo "åŒæ­¥å®Œæˆï¼Œæ£€æŸ¥logoæ–‡ä»¶åˆ—è¡¨ï¼š"
        ls -la logo/ || echo "logoæ–‡ä»¶å¤¹ä¸å­˜åœ¨"
        echo "æœ€è¿‘ä¸€æ¬¡æäº¤ä¿¡æ¯ï¼š"
        git log -1 --oneline